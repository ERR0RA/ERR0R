<script>
let currentAnswer = null;
let score = 0;
let answered = false;

// Utility function to get random integer in range
const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

// Clear previous question and feedback
function resetQuestion() {
    document.getElementById("feedback").innerText = "";
    document.getElementById("answerInput").value = "";
    currentAnswer = null;
    answered = false;
}

// Generate a ratio question
function generateRatioQuestion(difficulty) {
    const questionArea = document.getElementById("questionArea");
    if (difficulty === "easy") {
        const a = rand(1, 5), b = rand(1, 5);
        questionArea.innerHTML = `Simplify the ratio ${a*2}:${b*2}`;
        currentAnswer = `${a}:${b}`;
    } else if (difficulty === "medium") {
        const a = rand(1, 5), b = rand(1, 5);
        const total = (a + b) * rand(2, 4);
        const scale = total / (a + b);
        questionArea.innerHTML = `Share £${total} in the ratio ${a}:${b}. How much does the first person get?`;
        currentAnswer = (a * scale).toString();
    } else if (difficulty === "hard") {
        const a = rand(2, 6), b = rand(2, 6), c = rand(2, 6);
        const sumMultiplier = 5;
        questionArea.innerHTML = `Three numbers are in the ratio ${a}:${b}:${c}. Their sum is ${(a + b + c) * sumMultiplier}. Find the largest number.`;
        currentAnswer = (c * sumMultiplier).toString();
    }
}

// Generate a similar shapes question
function generateSimilarQuestion(difficulty) {
    const questionArea = document.getElementById("questionArea");
    if (difficulty === "easy") {
        const scale = rand(2, 5), length = rand(2, 10);
        questionArea.innerHTML = `Two similar shapes have scale factor ${scale}. If small length is ${length}cm, find the large length.`;
        currentAnswer = (length * scale).toString();
    } else if (difficulty === "medium") {
        const scale = rand(2, 4), area = rand(10, 30);
        questionArea.innerHTML = `Two shapes are similar with scale factor ${scale}. If small area is ${area}cm², find large area.`;
        currentAnswer = (area * scale ** 2).toString();
    } else if (difficulty === "hard") {
        const scale = rand(2, 4), volume = rand(5, 20);
        questionArea.innerHTML = `Two similar solids have scale factor ${scale}. If small volume is ${volume}cm³, find large volume.`;
        currentAnswer = (volume * scale ** 3).toString();
    }
}

// Main question generator
function generateQuestion() {
    resetQuestion();
    const topic = document.getElementById("topic").value;
    const difficulty = document.getElementById("difficulty").value;

    switch(topic) {
        case "ratio":
            generateRatioQuestion(difficulty);
            break;
        case "similar":
            generateSimilarQuestion(difficulty);
            break;
        default:
            document.getElementById("questionArea").innerHTML = "Select a valid topic.";
    }
}

// Check user's answer
function checkAnswer() {
    if (answered) return;

    const userAnswer = document.getElementById("answerInput").value.replace(/\s+/g,'');
    if (userAnswer === currentAnswer) {
        score++;
        document.getElementById("feedback").innerText = "Correct!";
    } else {
        document.getElementById("feedback").innerText = "Incorrect. Correct answer: " + currentAnswer;
    }

    document.getElementById("score").innerText = "Score: " + score;
    answered = true;
}

// Initialize first question
generateQuestion();
</script>
